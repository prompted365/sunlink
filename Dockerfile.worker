# syntax=docker/dockerfile:1
FROM continuumio/miniconda3

WORKDIR /app
COPY environment.yml /app/environment.yml

RUN conda env create -f environment.yml && conda clean -afy

# Activate conda environment
ENV PATH /opt/conda/envs/sunlink/bin:$PATH

# Copy application code
COPY . .

# Start Celery worker
CMD ["celery", "-A", "tasks.worker_tasks", "worker", "--loglevel=info"]